<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>tf.advanced.zipdata API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>tf.advanced.zipdata</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/annotation/text-fabric/blob/e933354a3e7dfd8a5126869b6538a40619237975/tf/advanced/zipdata.py#L1-L172" class="git-link">Browse git</a>
</summary>
<pre><code class="python">import os
import sys
from shutil import rmtree
from zipfile import ZipFile

from ..parameters import ZIP_OPTIONS, TEMP_DIR, RELATIVE, GH_BASE, DOWNLOADS
from ..core.helpers import console, splitModRef, normpath, expanduser

GH = expanduser(GH_BASE)
DW = expanduser(DOWNLOADS)

HELP = &#34;&#34;&#34;
USAGE

text-fabric-zip --help

text-fabric-zip {org}/{repo}/{relative}

EFFECT

Zips text-fabric data from your local github repository into
a release file, ready to be attached to a github release.

Your repo must sit in ~/github/{org}/{repo}.

Your TF data is assumed to sit in the toplevel tf directory of your repo.
But if it is somewhere else, you can pass relative, e.g phrases/heads/tf

It is assumed that your tf directory contains subdirectories according to
the versions of the main datasource.
The actual .tf files are in those version directories.

Each of these version directories will be zipped into a separate file.

The resulting zip files end up in ~/Downloads/{org}-release/{repo}
and the are named {relative}-{version}.zip
(where the / in relative have been replaced by -)
&#34;&#34;&#34;

EXCLUDE = {&#34;.DS_Store&#34;}


def zipData(
    org, repo, relative=RELATIVE, version=None, tf=True, keep=False, source=GH, dest=DW
):
    relative = normpath(relative)
    console(f&#34;Create release data for {org}/{repo}/{relative}&#34;)
    sourceBase = normpath(f&#34;{source}/{org}&#34;)
    destBase = normpath(f&#34;{dest}/{org}-release&#34;)
    sourceDir = f&#34;{sourceBase}/{repo}/{relative}&#34;
    destDir = f&#34;{destBase}/{repo}&#34;
    dataFiles = {}

    if not keep:
        if os.path.exists(destDir):
            rmtree(destDir)
    os.makedirs(destDir, exist_ok=True)
    relativeDest = relative.replace(&#34;/&#34;, &#34;-&#34;)

    if tf:
        if not os.path.exists(sourceDir):
            return
        with os.scandir(sourceDir) as sd:
            versionEntries = [(sourceDir, e.name) for e in sd if e.is_dir()]
        if versionEntries:
            console(f&#34;Found {len(versionEntries)} versions&#34;)
        else:
            versionEntries.append((sourceDir, &#34;&#34;))
            console(&#34;Found unversioned features&#34;)
        for (versionDir, ver) in versionEntries:
            if ver == TEMP_DIR:
                continue
            if version is not None and version != ver:
                continue
            versionRep = f&#34;/{ver}&#34; if ver else &#34;&#34;
            versionRep2 = f&#34;{ver}/&#34; if ver else &#34;&#34;
            versionRep3 = f&#34;-{ver}&#34; if ver else &#34;&#34;
            tfDir = f&#34;{versionDir}{versionRep}&#34;
            with os.scandir(tfDir) as sd:
                for e in sd:
                    if not e.is_file():
                        continue
                    featureFile = e.name
                    if featureFile in EXCLUDE:
                        continue
                    if not featureFile.endswith(&#34;.tf&#34;):
                        console(
                            f&#39;WARNING: non feature file &#34;{versionRep2}{featureFile}&#34;&#39;,
                            error=True,
                        )
                        continue
                    dataFiles.setdefault(ver, set()).add(featureFile)

        console(f&#34;zip files end up in {destDir}&#34;)
        for (ver, features) in sorted(dataFiles.items()):
            item = f&#34;{org}/{repo}&#34;
            versionRep = f&#34;/{ver}&#34; if ver else &#34;&#34;
            versionRep3 = f&#34;-{ver}&#34; if ver else &#34;&#34;
            target = f&#34;{relativeDest}{versionRep3}.zip&#34;
            console(
                f&#34;zipping {item:&lt;25} {ver:&gt;4} with {len(features):&gt;3} features ==&gt; {target}&#34;
            )
            with ZipFile(f&#34;{destDir}/{target}&#34;, &#34;w&#34;, **ZIP_OPTIONS) as zipFile:
                for featureFile in sorted(features):
                    zipFile.write(
                        f&#34;{sourceDir}{versionRep}/{featureFile}&#34;,
                        arcname=featureFile,
                    )
    else:
        def collectFiles(base, path, results):
            thisPath = f&#34;{base}/{path}&#34; if path else base
            # internalBase = f&#34;{relative}/{path}&#34; if path else relative
            internalBase = path
            with os.scandir(thisPath) as sd:
                for e in sd:
                    name = e.name
                    if name in EXCLUDE:
                        continue
                    if e.is_file():
                        results.append(
                            (f&#34;{internalBase}/{name}&#34;, f&#34;{base}/{path}/{name}&#34;)
                        )
                    elif e.is_dir():
                        collectFiles(base, f&#34;{path}/{name}&#34;, results)

        results = []
        versionRep = f&#34;/{version}&#34; if version else &#34;&#34;
        sourceDir = f&#34;{sourceDir}{versionRep}&#34;
        collectFiles(sourceDir, &#34;&#34;, results)
        if not relativeDest:
            relativeDest = &#34;-&#34;
        console(f&#34;zipping {org}/{repo}/{relative}{versionRep} with {len(results)} files&#34;)
        console(f&#34;zip file is {destDir}/{relativeDest}.zip&#34;)
        with ZipFile(f&#34;{destDir}/{relativeDest}.zip&#34;, &#34;w&#34;, **ZIP_OPTIONS) as zipFile:
            for (internalPath, path) in sorted(results):
                zipFile.write(
                    path,
                    arcname=internalPath,
                )


def main(cargs=sys.argv):
    if len(cargs) &lt; 2 or any(
        arg in {&#34;--help&#34;, &#34;-help&#34;, &#34;-h&#34;, &#34;?&#34;, &#34;-?&#34;} for arg in cargs
    ):
        console(HELP)
        return

    moduleRef = cargs[1]

    parts = splitModRef(moduleRef)
    if not parts:
        console(HELP)
        return

    (org, repo, relative, checkout) = parts
    relative = normpath(relative)

    tf = (
        relative == &#34;tf&#34;
        or relative.endswith(&#34;tf&#34;)
        or relative.startswith(&#34;tf/&#34;)
        or &#34;/tf/&#34; in relative
    )
    tfMsg = &#34;This is a TF dataset&#34; if tf else &#34;These are additional files&#34;
    sys.stdout.write(f&#34;{tfMsg}\n&#34;)

    zipData(org, repo, relative=relative, tf=tf)


if __name__ == &#34;__main__&#34;:
    main()</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="tf.advanced.zipdata.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>cargs=['/Library/Frameworks/Python.framework/Versions/3.10/bin/pdoc3', '--force', '--html', '--output-dir', 'site', '--template-dir', 'tf/docs/templates', 'tf'])</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/annotation/text-fabric/blob/e933354a3e7dfd8a5126869b6538a40619237975/tf/advanced/zipdata.py#L142-L168" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def main(cargs=sys.argv):
    if len(cargs) &lt; 2 or any(
        arg in {&#34;--help&#34;, &#34;-help&#34;, &#34;-h&#34;, &#34;?&#34;, &#34;-?&#34;} for arg in cargs
    ):
        console(HELP)
        return

    moduleRef = cargs[1]

    parts = splitModRef(moduleRef)
    if not parts:
        console(HELP)
        return

    (org, repo, relative, checkout) = parts
    relative = normpath(relative)

    tf = (
        relative == &#34;tf&#34;
        or relative.endswith(&#34;tf&#34;)
        or relative.startswith(&#34;tf/&#34;)
        or &#34;/tf/&#34; in relative
    )
    tfMsg = &#34;This is a TF dataset&#34; if tf else &#34;These are additional files&#34;
    sys.stdout.write(f&#34;{tfMsg}\n&#34;)

    zipData(org, repo, relative=relative, tf=tf)</code></pre>
</details>
</dd>
<dt id="tf.advanced.zipdata.zipData"><code class="name flex">
<span>def <span class="ident">zipData</span></span>(<span>org, repo, relative='tf', version=None, tf=True, keep=False, source='/Users/werk/github', dest='/Users/werk/Downloads')</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/annotation/text-fabric/blob/e933354a3e7dfd8a5126869b6538a40619237975/tf/advanced/zipdata.py#L43-L139" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def zipData(
    org, repo, relative=RELATIVE, version=None, tf=True, keep=False, source=GH, dest=DW
):
    relative = normpath(relative)
    console(f&#34;Create release data for {org}/{repo}/{relative}&#34;)
    sourceBase = normpath(f&#34;{source}/{org}&#34;)
    destBase = normpath(f&#34;{dest}/{org}-release&#34;)
    sourceDir = f&#34;{sourceBase}/{repo}/{relative}&#34;
    destDir = f&#34;{destBase}/{repo}&#34;
    dataFiles = {}

    if not keep:
        if os.path.exists(destDir):
            rmtree(destDir)
    os.makedirs(destDir, exist_ok=True)
    relativeDest = relative.replace(&#34;/&#34;, &#34;-&#34;)

    if tf:
        if not os.path.exists(sourceDir):
            return
        with os.scandir(sourceDir) as sd:
            versionEntries = [(sourceDir, e.name) for e in sd if e.is_dir()]
        if versionEntries:
            console(f&#34;Found {len(versionEntries)} versions&#34;)
        else:
            versionEntries.append((sourceDir, &#34;&#34;))
            console(&#34;Found unversioned features&#34;)
        for (versionDir, ver) in versionEntries:
            if ver == TEMP_DIR:
                continue
            if version is not None and version != ver:
                continue
            versionRep = f&#34;/{ver}&#34; if ver else &#34;&#34;
            versionRep2 = f&#34;{ver}/&#34; if ver else &#34;&#34;
            versionRep3 = f&#34;-{ver}&#34; if ver else &#34;&#34;
            tfDir = f&#34;{versionDir}{versionRep}&#34;
            with os.scandir(tfDir) as sd:
                for e in sd:
                    if not e.is_file():
                        continue
                    featureFile = e.name
                    if featureFile in EXCLUDE:
                        continue
                    if not featureFile.endswith(&#34;.tf&#34;):
                        console(
                            f&#39;WARNING: non feature file &#34;{versionRep2}{featureFile}&#34;&#39;,
                            error=True,
                        )
                        continue
                    dataFiles.setdefault(ver, set()).add(featureFile)

        console(f&#34;zip files end up in {destDir}&#34;)
        for (ver, features) in sorted(dataFiles.items()):
            item = f&#34;{org}/{repo}&#34;
            versionRep = f&#34;/{ver}&#34; if ver else &#34;&#34;
            versionRep3 = f&#34;-{ver}&#34; if ver else &#34;&#34;
            target = f&#34;{relativeDest}{versionRep3}.zip&#34;
            console(
                f&#34;zipping {item:&lt;25} {ver:&gt;4} with {len(features):&gt;3} features ==&gt; {target}&#34;
            )
            with ZipFile(f&#34;{destDir}/{target}&#34;, &#34;w&#34;, **ZIP_OPTIONS) as zipFile:
                for featureFile in sorted(features):
                    zipFile.write(
                        f&#34;{sourceDir}{versionRep}/{featureFile}&#34;,
                        arcname=featureFile,
                    )
    else:
        def collectFiles(base, path, results):
            thisPath = f&#34;{base}/{path}&#34; if path else base
            # internalBase = f&#34;{relative}/{path}&#34; if path else relative
            internalBase = path
            with os.scandir(thisPath) as sd:
                for e in sd:
                    name = e.name
                    if name in EXCLUDE:
                        continue
                    if e.is_file():
                        results.append(
                            (f&#34;{internalBase}/{name}&#34;, f&#34;{base}/{path}/{name}&#34;)
                        )
                    elif e.is_dir():
                        collectFiles(base, f&#34;{path}/{name}&#34;, results)

        results = []
        versionRep = f&#34;/{version}&#34; if version else &#34;&#34;
        sourceDir = f&#34;{sourceDir}{versionRep}&#34;
        collectFiles(sourceDir, &#34;&#34;, results)
        if not relativeDest:
            relativeDest = &#34;-&#34;
        console(f&#34;zipping {org}/{repo}/{relative}{versionRep} with {len(results)} files&#34;)
        console(f&#34;zip file is {destDir}/{relativeDest}.zip&#34;)
        with ZipFile(f&#34;{destDir}/{relativeDest}.zip&#34;, &#34;w&#34;, **ZIP_OPTIONS) as zipFile:
            for (internalPath, path) in sorted(results):
                zipFile.write(
                    path,
                    arcname=internalPath,
                )</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<p><a href="https://github.com/annotation" title="annotation on GitHub"><img src="../../tf/images/tf-small.png" alt="annotation"></a></p>
<p><a href="../../tf/index.html">tf home</a> -
<a href="../../tf/cheatsheet.html">cheat sheet</a> -
<a href="https://github.com/annotation/text-fabric" title="GitHub repo"><img src="../../tf/images/GitHub_Logo.png" alt="GitHub" width="50"></a></p>
</p>
<form>
<input id="lunr-search" name="q" placeholder="🔎 Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="tf.advanced" href="index.html">tf.advanced</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="tf.advanced.zipdata.main" href="#tf.advanced.zipdata.main">main</a></code></li>
<li><code><a title="tf.advanced.zipdata.zipData" href="#tf.advanced.zipdata.zipData">zipData</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<a href="https://pure.knaw.nl/portal/en/persons/dirk-roorda">Dirk Roorda</a>
<a href="https://www.dans.knaw.nl"><img alt="DANS" src="../../tf/images/DANS-logo.png" width="200" alt="DANS"></a>
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>